\documentclass[a4paper]{article}

%% Language and font encodings
\usepackage[english]{babel}
\usepackage[utf8x]{inputenc}
\usepackage[T1]{fontenc}

%% Sets page size and margins
\usepackage[a4paper,top=3cm,bottom=2cm,left=3cm,right=3cm,marginparwidth=1.75cm]{geometry}

%% Useful packages
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{amsmath,amsfonts,amssymb,amsthm}
\usepackage{mathtools,braket}
\usepackage{xifthen}
\usepackage[colorinlistoftodos]{todonotes}
\usepackage[colorlinks=true, allcolors=blue]{hyperref}

% notation for standard math
\renewcommand{\d}{\partial}
\newcommand{\half}{\frac{1}{2}}
\newcommand{\dd}{{\rm d}}
\renewcommand{\r}{{\bf r}}
\newcommand{\br}{\bar{\bf r}}
\newcommand{\x}{{\bf x}}
\newcommand{\eps}{\epsilon}
\newcommand{\bbomega}{{\bar{\bar\omega}}}
\newcommand{\ii}{\mathrm{i}}
\newcommand{\intdef}[3]{\int_{#1}^{#2} \dd {#3}}
\newcommand{\intover}[1]{\int_{-\infty}^{+\infty} \dd {#1}}
\newcommand{\sint}{\mathrlap{\displaystyle\int}
\mathrlap{\textstyle\sum}
\phantom{\mathrlap{\displaystyle
\int}\textstyle\sum}}

% notatiotion for equation environments
\newcommand{\be}{\begin{equation}}
\newcommand{\ee}{\end{equation}}
\newcommand{\ba}{\begin{eqnarray}}
\newcommand{\ea}{\end{eqnarray}}
\newcommand{\baa}{\begin{align}}
\newcommand{\eaa}{\end{align}}
\newcommand{\nn}{\notag}
\newcommand{\qq}{\qquad}
\newcommand{\lb}{\label}
\newcommand{\mat}[1]{\begin{pmatrix} #1\end{pmatrix}}

% notation for the operators
\newcommand{\op}[1]{\hat {#1}}
\newcommand{\sop}[1]{\op{\op {#1}}}
\newcommand{\commutator}[2]{\left[ {#1} , {#2} \right]}
\newcommand{\trace}[1]{\mathrm{tr}\left(#1\right)}
\newcommand{\argument}[1]{\ifthenelse{\isempty{#1}{}}{}{(#1)}}
\newcommand{\matop}[1]{\mathbf{#1}}
\newcommand{\optr}[1]{\check #1}

% notation for the states
\newcommand{\tket}[1]{| \tilde #1 \rangle}
\newcommand{\tbra}[1]{\langle \tilde #1 |}
\newcommand{\brket}[2]{\langle  #1 | #2 \rangle} %standard braket
\newcommand{\tbraket}[2]{\langle \tilde #1 | #2 \rangle}
\newcommand{\ketbra}[2]{| #1 \rangle \langle #2 |}
\newcommand{\tketbra}[2]{| #1 \rangle \langle \tilde #2 |}
\newcommand{\sket}[2]{| #2)^{#1}}
\newcommand{\sbra}[2]{( #2|_{#1}}
\newcommand{\sketor}[2]{| #2]^{#1}}
\newcommand{\sbraor}[2]{[ #2|_{#1}}
\newcommand{\sbraket}[2]{\braket{\op{#1} | \op{#2}}}
\newcommand{\dket}[1]{\Bigl| #1 \Bigr)}
\newcommand{\dbra}[1]{\Bigl(#1 \Bigr|}
\newcommand{\dbraket}[2]{\Bigl(#1 \Bigl| #2 \Bigr)}
\newcommand{\dketor}[1]{\Bigl| #1 \Bigr]}
\newcommand{\dbraor}[1]{\Bigl[#1 \Bigr|}
\newcommand{\hket}[1]{| #1 ]}
\newcommand{\hbra}[1]{[ #1 |}
\newcommand{\hbraket}[2]{[#1 | #2 ]}

% special operators
\newcommand{\dmnot}{\op{\rho}_0}
\newcommand{\dm}{\op{\rho}}
\newcommand{\hnot}{\op{H}_0}
\newcommand{\hone}[1]{\op{H}_1\argument{#1}}
\newcommand{\transition}[1]{\op T_{#1}}
\newcommand{\excite}[2]{\op e_{{#1}{#2}}}
\newcommand{\decay}[2]{\op d_{{#1}{#2}}}
\newcommand{\Liouv}{\sop{\mathcal L}}
\newcommand{\Liouvnot}{\sop{\mathcal L_0}}
\newcommand{\coupl}{\sop{\mathcal K}}
\newcommand{\honetmp}[1][]{\op{H_1}\argument{#1}} 
\newcommand{\identity}{\op{\mathbb I}}
\newcommand{\rmat}[1]{\optr R}


\title{Critical assessment of Linear-Response Excitations in Molecular system\\
or \\
On the Localization of the Linear-Response excitations in Open Systems}
\author{You}

\begin{document}
\maketitle

\begin{abstract}
By performing linear-response (LR)-TDDFT calculation of molecular systems within a highly complete real-space basis set, we analyze how the behavior of the dynamical 
polarizability is influenced by the discretization conditions of the computational treatment.
We show that optical excitations of energy below the LR ionization potential behave as observable, localized quantities, that can be studied with high precision, 
provided an adequate level of completeness. We then present indicators that can help to quantify such potential observable property of an excitation, that can be evaluated 
in any discretization scheme. Under this light, we also show that excitation energies above ionization threshold do not exhibit such observable features and \emph{cannot} be 
considered as poles of the dynamical polarizability. This result is a inherent behavior of the system's Liouvillian, and does not depend on computational treatment of the 
unoccupied subspace.
\end{abstract}

\section{Reboot with recent considerations}
\begin{itemize}
\item Write the excitations as the eigenstates of the Liouvillian:
\begin{itemize}
\item The Casida Matrix provides the eigenvectors in the basis of the unperturbed transitions
\item From the Casida eigenproblem we 
get the poles of the dynamical polarizability and we may reconstruct the perturbed wavefunctions
\item Lot of solution in state of 
the art to express \emph{the same information}, still by avoiding the explicit diagonalization of the problem
\end{itemize}
\item Such transitions might also be written in terms of the solutions of the eigenproblem for the perturbed hamiltonian
\begin{itemize}
\item There are therefore excitations which correspond to localized solutions of the above eigenproblems
\item There is a \emph{energy threshold} above which the eigenfunction associated \emph{cannot be anymore} localized
\end{itemize}
\item Below threshold, the eigenfunction are localized and the energy values are \emph{observable} quantities (there is a convergence in terms of the simulation parameters)
\begin{itemize}
\item Casida treatments for different
basis sets exhibit convergence of the low-energy excitations
\item Still, even for such localized excitations, non-trivial dependence on the empty states on some of excitation value is observed (energies converge relatively slowly wrt $N_\alpha$)
\item The locality of the excitation can be \emph{measured}
{\bf NEW idea for the SoB: why not to consider}
$$
\int \mathrm d \mathbf r
\rho(\mathbf r) |\phi_p^E(\mathbf r)|^2
$$
or similar quantities, that are independent on the number of empty and  bound states
\item Localized Excitation are the  only one with an observable character (this is surely already known)
\item The spectrum of the Liouvillian in this regime is a \emph{discrete} spectrum; the excitation energies are \emph{poles} of the dynamical polarizability
nano\item We may associate the value of the threshold to the \emph{ionization potential}: This is a very interesting remark in my opinion: the physics of the optical excitation is observable 
(and therefore localized) only if the energies are not higher than the energy needed to ionize the system. After this point, it seems normal to me that the ``optical'' excitations with 
real value of the energy are not  meant to be observable anymore.
\item Optical Excitations below threshold have therefore a (very) long lifetime (poles on the real axis), and they contribute to the analytic structure of the dynamical polarizability.
\end{itemize}
\item Above this threshold the energies have a strong dependence on the computational treatment
\begin{itemize}
\item The high-energy part of the 
spectrum does not converge with the 
boundary conditions, even though they converge wrt the empty states (established techniques \emph{do not solve} such problem)
\item This is \emph{not} a problem that is related to the continuum collapse of the empty states.
\item They belong to the continuum of  the Liouvillian $\rightarrow$ they collapse, or depend strongly on the basis set adopted
\item They cannot be considered separately \emph{even when they are expressed in localized basis} as 
their shape is dependent on the treatment
\item They energies are not \emph{true} poles of the dynamical polarizability (the spectra converge only by superposition of deltas)
\end{itemize}
\item Optical excitation above Ionization threshold are therefore observable \emph{only} if they possess a lifetime (the peaks of the spectrum have a well-defined broadening). 
In this way they might be expressed in terms of resonant wavefunctions
\end{itemize}

\section{THEORY}

\subsection{Basic definitions}\lb{BasicDef}

We consider a generic one-body quantum mechanical problem described by the hermitian Hamiltonian $\hnot$  written in terms of the standard 
kinetic operator $\op T$ plus a one-body potential $\op V$, which we assume to be completely general, i.e. possibly nonlocal.
We consider open systems, so that $\hnot$ is defined on $\mathbb L_2(\mathbb R_3)$ and the basis of its eigenfunctions spans this 
functional space. Therefore, together with the discrete (bound) part of its spectrum $\eps_b$, the Hamiltonian may have an essential spectrum 
$\eps(c)$, parametrized by the continuum label $c$. 

A generic state $\ket{f} \in \mathbb L_2(\mathbb R_3)$ can be expanded in the basis of the eigenstates of $\hnot$, that is:
\be\lb{ketBasisExpDef1}
\ket{f} = \sum_b f_b \ket{\psi_b} + \int \dd c f(c) \ket{\psi(c)}  = 
\sint \dd s f(s) \ket{\psi(s)} \;,
\ee
where we have introduced the compact multi-index $s$ that collect both the discrete and continuum part of the spectrum of $\hnot$.
The normalization of the basis can be chosen so that the standard orthonormality condition holds, that is: 
\be
\brket{\psi(s)}{\psi(s')} = \delta(s-s') \;,
\ee
and the completeness condition is written as:
\be\lb{completenessH0basis1}
\identity = \sint \dd s \ketbra{\psi(s)}{\psi(s)} = \sum_{b} \ketbra{\psi_b}{\psi_b} + \int \dd c \ketbra{\psi(c)}{\psi(c)} \;. 
\ee
Thanks to this condition the coefficients of the expansion \eqref{ketBasisExpDef1} can be expressed via a scalar products, namely $f_{b} = 
\brket{\psi_b}{f}$ and $f(c) = \brket{\psi(c)}{f}$.

\subsection{Time evolution of states in the linear response regime}

We discuss the time evolution of a generic state vector in the case in which a hermitian time dependent perturbation $\hone{t}$ is added to $\hnot$. 
To achieve this task we have to solve the time dependent Schroedinger equation supplied by the knowledge of the state at the ``initial'' time $t_0$.
We seek for a solution of the form:
\be\lb{ketTimeEvol1}
\ket{\psi(t_{0},t)} = e^{-\ii \hnot t} \op{U}_{I}(t,t_0) e^{\ii \hnot t_0}\ket{\psi_0} \; . 
\ee
where $\op{U}_I(t,t_0)$ is the time evolution operator induced by $\hone{}$ that satisfies the ``initial'' time condition $\op{U}_I(t_0,t_0)=1$. 
Plugging the expression \eqref{ketTimeEvol1} in the Schroedinger equation we obtain a differential equation for $\op{U}_I$ that can be solved 
iteratively as a power series in $\hone{}$. Limiting to the linear order provides:
\be \lb{UiLinOrderSol1}
\op{U}_I(t,t_0) = \identity - \ii \intdef{t_0}{t}{t'} e^{\ii \hnot t'} \hone{t'} e^{-\ii \hnot t'} \; .
\ee
So, at the first order in $\hone{}$ equation \eqref{ketTimeEvol1} can thus be written as:
\be \lb{ketTimeEvol2} 
\ket{\psi(t_{0},t)} = \left( \op{U}_0(t-t_0) - \ii \intdef{t_0}{t}{t'} \op{U}_0(t-t') \hone{t'} 
\op{U}_0(t'-t_0) \right)\ket{\psi_0} \; ,
\ee
were we have defined the time evolution operator of the unperturbed Hamiltonian by
\be
\op{U}_0(t-t_0)\equiv e^{-\ii \hnot(t -t_0)} \;.
\ee
The time evolution of left vectors can be derived in the same way. We can express the temporal evolution of the left 
vectors in the form:
\be \lb{braTimeEvol1}
\bra{\psi(t_{0},t)} = \bra{\psi_0} e^{-\ii \hnot t_0} \op{U}_{I}(t_0,t) e^{\ii \hnot t} \;,
\ee
plugging this equation in the conjugate Schroedinger equation and pursuing the same procedure defined above, we obtain the 
linear order expression of time evolution of left vectors:
\be\lb{leftVectTimeEvol2}
\bra{\psi(t_{0},t)} = \bra{\psi_0} \left( \op{U}_0(t_0-t) + \ii \intdef{t_0}{t}{t'} \op{U}_0(t_0-t') 
\hone{t'} \op{U}_0(t'-t) \right) 
\ee
It is immediate to check that, in order to preserve the norm vectors during the time evolution, it is sufficient that $\op{U}_I$ 
possesses the  semi-group structure $\op{U}_I(t_2,t_1) \op{U}_I(t_1,t_0) = \op{U}_I(t_2,t_0)$. An inspection of \eqref{UiLinOrderSol1}
evidences that this condition is satisfied in the linear response regime.


\subsubsection{Time evolution of stationary states. Adiabatic limit vs finite time switch-on procedure}

We are interested in determining the time evolution of an eigenstate of $\hnot$ under the action of the perturbation $\hone{t}$ in the linear 
response regime. A proper statement of the problem requires the specification of the way in which the perturbation is switched on.
Possible choice of the switching on protocol are, for instance, the \emph{adiabatic limit} and the \emph{sudden limit} protocols. In the first
case the perturbation is switched on at $t_0=-\infty$, but the intrinsic time structure of $\hone{}$ is modified by the damping function 
$e^{-\eta_a |t|}$. In the second one the perturbation is abruptly switched on at the finite time $t_0$, so that the time structure of
$\hone{}$ is multiplied times the $\theta$-function $\theta(t-t_0)$.

Starting from the generic time evolution equation \eqref{ketTimeEvol2} and choosing the initial condition in the form 
$\ket{\psi_0} = e^{-\\i \eps_b t_0}\ket{\psi_b}$, we can write the time evolution of the generic $\ket{\psi_b}$ eigenvector of $\hnot$ as:
\be \lb{ketTimeEvol3} 
\ket{\psi_b(t)} = e^{-\ii \eps_b t}\left( \identity - \ii \intdef{t_0}{t}{t'} \op{U}_0(t-t') \op\Phi^{a.l,s.l}(t') \op{U}_0(t'-t)  \right)\ket{\psi_b} \; ,
\ee
where we have introduced the \emph{perturbing field operators}: 
\be
\op\Phi^{a.l.}(t) = e^{-\eta_a |t|} \hone{t} \;, \qq
\op\Phi^{s.l.}(t) = \theta(t-t_0) \hone{t}
\ee
that codify the effective of the perturbing Hamiltonian in the specific switch-on procedure. Making usage of elementary properties of $\theta$ functions allows us
to rewrite the former time integral as:
\be\lb{AopDef1}
\op A(t) = \intdef{-\infty}{\infty}{t'} \op{U}^{+}_0(t-t') \op\Phi^{a.l,s.l}(t') \op{U}^{-}_0(t'-t) \;,
\ee
so that the effect of the switch-on protocol are completely reabsorbed in the perturbing field. In the subsequent analysis we will omit the apex in the fields $\op\Phi$, 
unless explicitly needed, to keep notations as simple as possible. Thanks to this definition we can express the time evolution of the eigenvectors of $\hnot$ in the 
compact form:
\be\lb{ketBraTimeEvol1}
\ket{\psi_b(t)} = e^{-\ii \eps_b t}\left( \identity - \ii \op A(t)  \right)\ket{\psi_b} \; , \qq 
\bra{\psi_b(t)} = \bra{\psi_b} \left( \identity + \ii \op A(t)  \right) e^{\ii \eps_b t} \; .
\ee

\subsection{Linear response on the density operator. Liouville equation in the time domain}

We introduce the \emph{density operator} defined as the sum of the one-particle densities of all the states with energy lower than the \emph{chemical potential} 
(Fermi energy):
\be\label{rhodef1}
\dmnot = \sum_{\{p\}} \ket{\psi_p} \bra{\psi_p}  \;,
\ee
where the index $p$ labels the occupied state, \emph{i.e} the subset of the bound eigenstates of $\hnot$ with energy lower than the Fermi energy.
Clearly $\dmnot$ commutes with $\hnot$ and in the unperturbed case is a time-independent operator. When the perturbation is switched the system starts to evolve
and we indicate with $\dm(t)$ the modified density of the perturbed system. We introduce the shorthand notation:
\be\lb{rhodef2}
\dm(t)  =  \dmnot + \dm'(t)\;,
\ee
where $\dm'(t)$ is called the \emph{response density operator} and represents the time dependent modification of the ground state density induced by the perturbation.
Here we are assuming that the highest occupied energy level and the lowest unoccupied one will never intersect during the time evolution. Thanks to this condition, the 
linear response regime the expression of $\dm'(t)$ can be readily derived using equations \eqref{ketBraTimeEvol1} and reads:  
\be\lb{rhoTimeEvolutionDef3}
\dm'(t) = \ii \commutator{\dmnot}{\op A(t)} \;.
\ee
The equation of motion (Liouville equation) for $\dm'$ is obtained by performing the time derivative of the previous equation. The derivative of $\op A(t)$ can be 
computed starting from its definition and reads:
\be
\d_t\op A(t) = \op\Phi(t) -\ii \commutator{\hnot}{\op A(t)} \nn \;,
\ee
and using the Jacobi identity we have:
\be\lb{LiouvilleRhoDef1}
\ii \d_t \dm'(t) = \commutator{\op\Phi(t)}{\dmnot} + \ii\commutator{\hnot}{\commutator{\dmnot}{\op A(t)}} = 
\commutator{\op\Phi(t)}{\dmnot} + \commutator{\hnot}{\dm'(t)} \;.
\ee
It is useful to introduce the \emph{Liouvillian} superoperator:
\be\lb{L0sopDef1}
\Liouvnot \equiv \commutator{\hnot}{\cdot} \;,
\ee
so that the Liouville equation can be written as:
\be\lb{LiouvilleRhoDef2}
\ii \d_t \dm'(t) = \Liouvnot \dm'(t) + \commutator{\op\Phi(t)}{\dmnot} \;.
\ee

\subsection{Self-consistent Hamiltonians. Generalized Liouville operator}

Let us extend the the former analysis to self-consistent systems, \emph{i.e.} to the case in which the unperturbed Hamiltonian is itself a function of the density.
In this case the perturbing field $\op\Phi$ has also the effect of adding a further perturbation operator to the perturbing Hamiltonian. In the linear response framework, 
this latter quantity can be expressed as the functional derivatives of $\hnot$ with respect to the density kernel (evaluated at $\dm=\dmnot$) times the value of the
induced density modification, that is:
\be\label{Vptspacedef1}
\op V'(t)= 
\int \dd \r \dd \r' \frac{\delta\hnot}{\delta \rho_0(\r,\r')}
\trace{\dm'(t) \ket{\r} \bra{\r'}} \;.
\ee
The Liouville equation for self-consistent systems can be written by adding the contribution of $\op V'$ to $\op\Phi$ in \eqref{LiouvilleRhoDef2}. 
It reads:
\be\lb{LiouvilleRhoSelfDef1}
\ii \d_t \dm'(t) = \Liouvnot \dm'(t) + \commutator{\op V'(t)}{\dmnot} + \commutator{\op \Phi(t)}{\dmnot} \;.
\ee
We point out that the response density operator obeys a self-consistent equation, since the  induced perturbing field $\op V'$ is itself a function of $\dm'$. 
It is possible to formally recast \eqref{LiouvilleRhoSelfDef1} in the same form of \eqref{LiouvilleRhoDef2} by introducing the \emph{coupling}
superoperator:
\be\lb{couplingSopDef1}
\coupl = 
\int \dd \r \dd \r' \commutator{\frac{\delta\hnot}{\delta \rho_0(\r,\r')}}{\dmnot}
\trace{\cdot \ket{\r} \bra{\r'}} \;,
\ee
in this way the first commutator in \eqref{LiouvilleRhoSelfDef1} can be written as the formal action of the coupling superoperator to $\dm'$ and \eqref{LiouvilleRhoSelfDef1}
can be written as:
\be\lb{LiouvilleRhoSelfDef2}
\ii \d_t \dm'(t) = \Liouv \dm'(t) + \commutator{\op \Phi(t)}{\dmnot} \;, \qq
\Liouv = \Liouvnot + \coupl \;.
\ee

\subsection{Formulation in the frequency domain}

We reformulate the Liouville equation \eqref{LiouvilleRhoSelfDef2} in the frequency domain. In order to achieve this task it is
preferable to directly compute the action of the Liouville operator on the Fourier transform of the response density, since in this
way some subtleties that concerns the analytic structure in the $\omega$ complex plane can be properly taken into account.
We first define the response density in the frequency domain that, staring from \eqref{rhoTimeEvolutionDef3}, is given by:
\be\lb{rhoPrimeOmegaDef1}
\dm'(\omega) \equiv \intover{t} e^{\ii \omega t} \dm'(t)
= \ii \commutator{\dmnot}{\op A(\omega)} \;,
\ee
where $\op A(\omega)$ is The Fourier transform of \eqref{AopDef1} and reads:
\be \lb{AomegaDef1}
\op A(\omega) = \frac{1}{2\pi} \int_{-\infty}^\infty  \dd \omega'
\op G_0^+(\omega') \op \Phi(\omega) \op G_0^-(\omega'-\omega)\;.
\ee
The action of $\Liouvnot$ on $\dm'(\omega)$ follows from \eqref{L0sopDef1}:
\be\lb{LiouvillianRhopomegaDef1}
\Liouvnot \dm'(\omega) = \ii \commutator{\hnot}{\commutator{\dmnot}{\op A(\omega)}} = 
\ii \commutator{\dmnot}{\commutator{\hnot}{\op A(\omega)}} \;,
\ee
and the commutator between the unperturbed Hamiltonian and $\op A(\omega)$ can be directly computed starting from \eqref{AomegaDef1}: 
\be
\commutator{\hnot }{\op A(\omega)} = \bbomega \op A(\omega) - \ii \op \Phi(\omega)\;, \nn
\ee
where $\bbomega \equiv \omega + 2\ii\eta$, so that:
\be\lb{LiouvillianRhopomegaDef2}
\Liouvnot \dm'(\omega) =  \bbomega\dm'(\omega) + \commutator{\dmnot}{\op\Phi(\omega)}\;.
\ee
The coupling superoperator has the same formal action on the response density both in the time and in the frequency domain, so the complete
Liouville equation in $\omega$ space can be written as:
\be\lb{LiouvillianRhopomegaDef3}
\left(\bbomega - \Liouv\right) \dm'(\omega) =  \commutator{\op\Phi(\omega)}{\dmnot}\;.
\ee

\subsection{Analysis of the excitations}

\subsubsection{Definition of the basis of transitions}

We now introduce the notion of \emph{basis of transitions} and identify the operators than can be expanded in such a basis. 

We split the complete
set of eigenstates of $\hnot$ in two sets. The first one is composed by the eigenvectors of $\hnot$ in the subspace of the occupied orbitals. The second 
one is composed by the remaining eigenvectors, both in the bound and in the continuum region, and its elements are denoted as $\ket{\psi(\alpha)}$, where $\alpha$ 
is a multi-index in the sense described in \ref{BasicDef}. The elements of these sets satisfy the following orthonormality relation: 
\be\lb{orthonormalityDef1}
\brket{\psi(\alpha)}{\psi_p} = \brket{\psi_p}{\psi(\alpha)} = 0 \;, \qq \brket{\psi_p}{\psi_q} = \delta_{pq} \;, \qq
\brket{\psi(\alpha)}{\psi(\beta)} = \delta(\alpha-\beta) \;.
\ee
Obviously, the direct sum of these two sets coincides with the complete set of eigenstates of $\hnot$ and thus 
constitute a complete basis. 
A generic operator can be decomposed in this basis and its formal expansion contains four distinct contribution of the form $\ketbra{\psi_p}{\psi_q}$, 
$\ketbra{\psi(\alpha)}{\psi(\beta)}$, $\ketbra{\psi(\alpha)}{\psi_p}$, $\ketbra{\psi_p}{\psi(\alpha)}$. However an inspection of equations \eqref{rhoPrimeOmegaDef1}
and \eqref{LiouvillianRhopomegaDef3} evidences that the relevant operators in the contest of the linear response are expressed as a commutator with $\dmnot$. 
For this class of operators the only non vanishing contribution comes from the \emph{transition operators}:
\be
\excite{p}{\alpha} \equiv \ketbra{\psi(\alpha)}{\psi_p}\;, \qq
\decay{\alpha}{p} \equiv \ketbra{\psi_p}{\psi(\alpha)} \;.
\ee
The orthonormality conditions \eqref{orthonormalityDef1} imply that:
\be\lb{transitionOpOrthonormalityDef1}
\trace{\excite{p}{\alpha}\excite{q}{\beta}} = \trace{\decay{\alpha}{p}\decay{\beta}{q}} = 0 \;, \qq
\trace{\excite{p}{\alpha}\decay{\beta}{q}} = \delta_{pq}\delta(\alpha-\beta) \;,
\ee
so that the expansion of a suitable operator $\op O$ in the basis of transitions reads:
\be\lb{OperatorTransBasisExpDef1}
\op O = \sum_p\sint \dd \alpha\left(
\excite{p}{\alpha}\trace{\decay{\alpha}{p}\op O} + \decay{\alpha}{p}\trace{\excite{p}{\alpha}\op O}
\right) \;.
\ee
In order to recast this expansion in a simpler expression it turns out to be useful to define the rank-2 row vectors of the transition basis: 
\be
\sbra{p\alpha}{\cdot} \equiv 
\mat{ \excite{p}{\alpha} \;, & \decay{\alpha}{p} }\;,
\ee
and we also introduce a vectorial notation to deal with the coefficients of the expansion of an operator in the transition basis, that is: 
\be\lb{OperatorTransitionCoeffDef1}
\sket{p\alpha}{\op O}  \equiv \mat{ \trace{\decay{\alpha}{p}\op O } \\ 
\trace{\excite{p}{\alpha}\op O}} \; .
\ee
Thanks to this formalism we have that equation \eqref{OperatorTransBasisExpDef1} can be expressed as:
\be\lb{OperatorTransBasisExpDef2}
\op O = \sum_p\sint \dd \alpha \sbra{p\alpha}{\cdot}\sket{p\alpha}{\op O} = 
\dbraket{\cdot}{\op O} \;,
\ee
where the last equality implicitly define the ulterior compact notation of the ``big-shaped'' vectors in which the summed indexes are omitted.  
In the same fashion it will be also useful for the subsequent analysis to introduce a ``conjugate'' notation, in which the basis operators are expressed
as column vector and the coefficients of the expanded operator as row ones, that is: 
\be\lb{TransitionBasisConjugateDef1}
\sket{p\alpha}{\cdot} \equiv 
\mat{\decay{\alpha}{p} \\  \excite{p}{\alpha}} \;, \qq
\sbra{p\alpha}{\op O}  \equiv 
\mat{ \trace{\excite{\alpha}{p}\op O } \;, & \trace{\decay{p}{\alpha}\op O} }
\;,
\ee
where the flip in the role of $\op e$ and $\op d$ in \eqref{TransitionBasisConjugateDef1} follows from the properties of excitation and decay operators
under hermitian-conjugate operation. The expansion of a suitable operator in the transition basis using the conjugate description reads: 
\be\lb{OperatorTransBasisConjugateExpDef1}
\op O = \sum_p\sint \dd \alpha \sbra{p\alpha}{\op O}\sket{p\alpha}{\cdot} = 
\dbraket{\op O}{\cdot} \;.
\ee

\subsubsection{Spectral decomposition of the response density in the transitions basis}

The Liouville equation \eqref{LiouvillianRhopomegaDef3} can be consistently written in the transition basis. Indeed, its r.h.s is explicitly written
as a commutator with $\dmnot$, while an inspection of the formal definition of the response density and of the Liouville superoperator evidences that
they both contain a commutator with $\dmnot$. Written in the basis of transitions Liouville equation becomes a linear matrix equation for the rank-2 
vectors of the coefficients \eqref{OperatorTransitionCoeffDef1} of the operators in its left and right side:
\be
\omega\mat{ \trace{\decay{\alpha}{p}\dm'(\omega)} \\ \trace{\excite{p}{\alpha}\dm'(\omega)}} - 
\mat{ \trace{\decay{\alpha}{p}\Liouv\dm'(\omega)} \\ \trace{\excite{p}{\alpha}\Liouv\dm'(\omega)}} =
\mat{ \trace{\decay{\alpha}{p}\commutator{\op\Phi(\omega)}{\dmnot}} \\ \trace{\excite{p}{\alpha}\commutator{\op\Phi(\omega)}{\dmnot}}}
\;.\nn
\ee
The second addend in the l.h.s can be further analyzed by writing the transition basis expansion of $\dm'$ inside the traces. Performing this procedure
we can recast this quantity as the action of a 2-dimensional matrix on the rank-2 vector of the response density. So we have: 
\be\lb{LiouvilleTransBasisDef1}
\sum_q\sint\dd\beta \left[\omega\delta_q^p\delta(\alpha-\beta)- \optr{L}^{p \alpha}_{q\beta} \right]\sket{q\beta}{\dm'(\omega)} =
\sket{p\alpha}{\commutator{\op\Phi(\omega)}{\dmnot}} \;.
\ee
with:
\be\lb{LiouvilleMatrixTransBasisDef1}
\optr{L}^{p \alpha}_{q\beta} \equiv \mat{\trace{\decay{\alpha}{p}\, \Liouv\, \excite{q}{\beta}} &
\trace{\decay{\alpha}{p}\, \Liouv\, \decay{\beta}{q}} \\
\trace{\excite{p}{\alpha}\, \Liouv\, \excite{q}{\beta}} &
\trace{\excite{p}{\alpha}\, \Liouv\, \decay{\beta}{q}}} \;.
\ee
This formulation of the Liouville equation is the starting point for the derivation of the spectral decomposition of the response density operator
in terms of the eigenvectors if the Liouville operator. 
The first step in the achievement of this result is provided by the construction of the eigenvectors of the matrix \eqref{LiouvilleMatrixTransBasisDef1}.
Following the notation previously defined we introduce the rank-2 vectors $\sket{p\alpha}{E}$ and $\sbra{p\alpha}{\tilde E}$ that represent, by definition,
the right and left eigenvectors $\optr{L}$, respectively, so that:
\be\lb{LiouvMatrixEigenvectorDef1}
\sum_q \sint \dd \beta \optr{L}^{p \alpha}_{q\beta} \sket{q \beta}{E} = E \sket{p\alpha}{E} \;, \quad
\sum_p \sint \dd \alpha \sbra{p\alpha}{\tilde E} \optr{L}^{p \alpha}_{q\beta} = E \sbra{q\beta}{\tilde E}\;.
\ee
In general, left and right eigenvectors do not coincide, but it is always possible to choose they normalization so that a orthonormality conditions among the
elements of left and right spaces holds, namely:
\be\lb{ExcitationOrthonormalityDef1}
\sum_p \sint \dd \alpha \sbra{p\alpha}{\tilde E}\sket{p\alpha}{E'} \equiv \dbraket{\tilde E}{E'} = \delta(E-E') \;.
\ee
Once that the eigenvectors are known, the spectral decomposition of the resolvent of $\optr{L}$ can be provided:  
\be
\left[\left(\bbomega-\optr{L}\right)^{-1}\right]^{p\alpha}_{q\beta} =\sint\dd E
\frac{\sket{p\alpha}{E}\sbra{q\beta}{\tilde E}}{\bbomega-E} \;,
\ee
so equation \eqref{LiouvilleTransBasisDef1} can be inverted:
\be\lb{RhopExcitationTransBasisDef1}
\sket{p\alpha}{\dm'(\omega)} = \sint\dd E \sket{p\alpha}{E}
\frac{\sum_q \sint \dd \beta\sbra{q\beta}{\tilde E}
\sket{q\beta}{\commutator{\op\Phi(\omega)}{\dmnot}}}{\bbomega-E} \;,
\ee
that can be compactly rewritten by using the index-less notation:
\be\lb{RhopExcitationTransBasisDef2}
\sket{p\alpha}{\dm'(\omega)} = 
\sint\dd E \sket{p\alpha}{E}
\frac{\dbraket{\tilde E}{\commutator{\op\Phi(\omega)}{\dmnot}}}{\bbomega-E} \;.
\ee

\subsubsection{Excitation operators}

We introduce the explicit representation of the eigenvectors op $\optr{L}$:
\be\lb{XYcoeffDef1}
\sket{p\alpha}{E} \equiv \mat{X_E^{p\alpha} \\ Y_E^{p\alpha}} \;, \qq
\sbra{p\alpha}{\tilde E} \equiv \mat{\tilde X_{E\,p\alpha} & \tilde Y_{E\,p\alpha}} \;,
\ee
and on the basis of these elements we define the \emph{excitation operators}:
\begin{align}\lb{ExctitationOperatorsDef1}
\op E &\equiv \dbraket{\cdot}{E} = 
\sum_p \sint \dd \alpha \left(\excite{p}{\alpha} X_E^{p\alpha} + \decay{\alpha}{p} Y_E^{p\alpha}\right) 
\;,\nn \\
\op{\tilde E} &\equiv \dbraket{\tilde E}{\cdot} = \sum_p \sint \dd \alpha \left(\decay{\alpha}{p} \tilde X_{E\,p\alpha} + 
\excite{p}{\alpha}\tilde Y_{E\,p\alpha}  \right)\;.
\end{align}
The orthonormality condition \eqref{ExcitationOrthonormalityDef1} implies that:
\be
\trace{\op{\tilde E} \op E'} = \sum_p\sint \dd\alpha \left(\tilde X_E^{p\alpha} X_{E'\,p\alpha} +
\tilde Y_E^{p\alpha} Y_{E'\,p\alpha}\right) = \delta(E-E') \;. 
\ee
Excitation operators are the right and left eigenvectors of the Liouville superoperator, as directly follows from their
definition. Indeed for $\op E$ we have:
\begin{align}\lb{opEeigenvalueDef1}
\Liouv \op E & = \sum_p \sint \dd \alpha \left(\trace{\decay{\alpha}{p} \Liouv \op E} \excite{p}{\alpha} + 
\decay{\alpha}{p} \trace{ \excite{p}{\alpha} \Liouv \op E}  \right) = \nn \\
&= \sum_p \sint  \dd \alpha \sbra{p\alpha}{\cdot} \sum_q \sint  \dd \beta \optr{L}^{p \alpha}_{q\beta} \sket{q\beta}{E} 
= E \sum_p \sint \dd \alpha \sbra{p\alpha}{\cdot} \sket{p\alpha}{E} = E \, \op E \;,	
\end{align}
whereas the left action on $\op{\tilde E}$ provides:
\begin{align}\lb{optildeEeigenvalueDef1}
 \op{\tilde E} \Liouv &=  \sum_p \sint \dd \alpha \left(
\trace{\op{\tilde E}\Liouv\excite{p}{\alpha}}\decay{\alpha}{p} +  
\trace{\op{\tilde E}\sop{\mathcal L}\decay{\alpha}{p}} \excite{p}{\alpha} \right) = 
\nn \\ &= \sum_p \sint  \dd \alpha  \sum_q \sint  \dd \beta
\sbra{q\beta}{\tilde E}\optr{L}^{q\beta}_{p\alpha}\sket{p\alpha}{\cdot} = 
E\sum_p \sint \dd \alpha \sbra{p\alpha}{\tilde E} \sket{p\alpha}{\cdot}  =
E \op{\tilde E} \;.
\end{align}
The introduction of the excitation operators allows to provide a complete operator version of equation \eqref{RhopExcitationTransBasisDef2}, that is:
\be\lb{RhopExcitationDef1}
\dm'(\omega) = 
\sint\dd E \op E
\frac{\trace{\op{\tilde E}\commutator{\op\Phi(\omega)}{\dmnot}}}{\bbomega-E} \;,
\ee
where the algebraic equivalence between the trace written in \eqref{RhopExcitationDef1} and the numerator of \eqref{RhopExcitationTransBasisDef2}
can be easily proved.

\subsubsection{Schroedinger-like equation for excitonic states}

We introduce the \emph{excitonic states} defined via the linear combination of the basis set orthogonal to $\dmnot$ with the
coefficients that appears in \eqref{XYcoeffDef1}, that is:
\begin{align}
\ket{\phi^E_p} &\equiv \sint \dd \alpha X_{E}^{p \alpha} \ket{\psi(\alpha)} &
\tbra{\phi^E_p} &\equiv \sint \dd \alpha {\tilde X_{E}^{p \alpha}} \bra{\psi(\alpha)} \;, \nn\\
\bra{\chi^E_p} &\equiv \sint \dd \alpha  Y_{E}^{p \alpha} \bra{\psi(\alpha)} &
\tket{\chi^E_p} &\equiv \sint \dd \alpha {\tilde Y}_{E}^{p\alpha} \ket{\psi(\alpha)} \;.
\end{align}
Thanks to these definitions we can express the excitation operators as follows:
\be\lb{ExctitationOperatorsDef2}
\op E = \sum_p \left( \ket{\phi^E_p}\bra{\psi_p} + \ket{\psi_p} \bra{\chi^E_p}\right)\;, \qq
\op {\tilde E} = \sum_p \left( \ket{\psi_p} \tbra{\phi^E_p} + \tket{\chi^E_p}\bra{\psi_p} \right)\;.
\ee
The operator eigenvalue equations \eqref{opEeigenvalueDef1} and \eqref{optildeEeigenvalueDef1} can be translated into a Schroedinger-like equations
for the excitonic states. 

\vspace{0.5cm}
\emph{Equations for $\coupl = 0$}
\vspace{0.5cm}


\noindent In this case the $\optr{L}_{q\beta}^{p\alpha}$ matrix has only diagonal non-vanishing elements, given by: 
\be
\trace{\decay{\alpha}{p}\Liouv\excite{q}{\beta}} = H_{0\alpha\beta}\delta_{pq} - \eps_p\delta_{pq}\delta(\alpha-\beta) \;, \qq
\trace{\excite{\alpha}{p}\Liouv\decay{q}{\beta}} = \eps_p\delta_{pq}\delta(\alpha-\beta) - H_{0\beta\alpha}\delta_{pq} \;, 
\ee
where $H_{0\alpha\beta} = \bra{\psi(\alpha)}\hnot\ket{\psi(\beta)}$. The eigenvalue conditions \eqref{LiouvMatrixEigenvectorDef1} imply
that the $Y$ and $\tilde Y$ coefficients introduced in \eqref{XYcoeffDef1} vanish so that both $\tket{\chi^E_p}$ and $\bra{\chi^E_p}$ do not
contribute to the excitation operators \eqref{ExctitationOperatorsDef2}. The eigenvalue operator equation for $\op E$ reduces to:
\be
\sum_q\left(\hnot - \eps_q\right)\ket{\phi^E_q}\bra{\psi_q} = E \sum_q \ket{\phi^E_q}\bra{\psi_q} \;,
\ee
and projecting on $\ket{\psi_q}$ provides the eigenvalue condition for the excitonic state $\ket{\phi^E_p}$:
\be
\left(\hnot - \eps_p\right)\ket{\phi^E_p} = E \ket{\phi^E_p} \;.
\ee
In the same way, by using the eigenvalue condition for $\op{\tilde E}$, we can derive an analogous equation for $\tbra{\phi^E_p}$. To achieve this
result we need the expression of the left action of the (unperturbed) Liouville superoperator defined in \eqref{L0sopDef1}, that can be derived by
observing that:
\be\lb{leftActionLouv0Def1}
\trace{\op O' (\Liouvnot \op O)} = \trace{(\op O' \Liouvnot) \op O } =
\trace{\commutator{\op O'}{\op H_0} \op O} \quad \Rightarrow \quad \op O \Liouvnot = 
- \Liouvnot \op O \;.
\ee
So, the eigenvalue operator equation for $\op{\tilde E}$ provides:
\be
\sum_q  \ket{\psi_q} \tbra{\phi^E_q} \left( \hnot - \eps_q \right) =
E \sum_q  \ket{\psi_q} \tbra{\phi^E_q} \;,
\ee
so that:
\be
\tbra{\phi^E_p} \left( \hnot - \eps_p \right) = E \tbra{\phi^E_p} \;.
\ee
So we find that the excitonic states are the left and right eigenvectors of $\hnot$ (that actually coincide since we are considering
hermitian Hamiltonians). The energy eigenvalue is shifted by $\eps_p$, that is the energy of the occupied states involved in the 
excitation. 

A last interesting comment regards the expression of the response density when the excitation operator $\op E$ itself is used as the source of the
perturbation. In this case, denoting as $\op E'$ the given perturbing excitation, it is easy to see that:
\be
\trace{\op{\tilde E}\commutator{\op E'}{\dmnot}} = \trace{\op{\tilde E}\op E'} = \delta(E-E') \;, \nn 
\ee
and the response density generated by this perturbation is given by: 
\be
\dm'(\omega) = \frac{1}{\bbomega - E'} \op E'\;,
\ee
which represents a monochromatic term of energy $E'$. Under this perspective we can state that excitations constitute
the \emph{resonant channels} for the construction  of the response density.

\vspace{0.5cm}
\emph{Generic equations for $\coupl \neq 0$}
\vspace{0.5cm}

To explicitly write the generic eigenvalue equations for the excitonic states it is useful to introduce some further formalism to express the 
self-consistent part of the perturbing Hamiltonian \eqref{Vptspacedef1}. We start by expanding $\op V'$ in the coordinate representation, that is:
\be
\op V'(t)= 
\int \dd \br \dd \br' \dd \r \dd \r' \bra{\br'}\frac{\delta\hnot}{\delta \rho_0(\r,\r')}\ket{\br}
\trace{\dm'(t) \ket{\r} \bra{\r'}} \ketbra{\br'}{\br}\;, \nn
\ee
then we introduce the \emph{coupling kernel}, defined as:
\be\lb{couplingKernelDef1}
U\left[\op O; \op O'\right] \equiv  \int \dd \r \dd \r' \trace{\op O \frac{\delta \hnot }{\delta \rho_0(\r,\r')}
} \trace{\op O' \ket{\r} \bra{\r'}} \;,
\ee
using this quantity we can express $\op V'$ as:
\be\lb{Vptspacedef2}
\op V'(t)= 
\int \dd \br \dd \br' U\left[\ketbra{\br}{\br'};\dm'(t)\right] \ketbra{\br'}{\br}\;,
\ee
and consequently the formal action of the coupling superoperator \eqref{couplingSopDef1} can be expressed as: 
\be\lb{couplingSopDef2}
\coupl\op O = 
\int \dd \r \dd \r' \commutator{\ketbra{\r'}{\r}}{\dmnot} U\left[\ketbra{\r}{\r'};\op O\right] \;.
\ee
Using this formalism we can define the left action of the coupling superoperator, in analogous way of what done in \eqref{leftActionLouv0Def1}, 
that is:
\begin{align}\lb{leftActionCouplingDef1}
\trace{\op O' (\coupl \op O)} &= \int \dd\r\dd\r'\trace{\ketbra{\r'}{\r}\commutator{\dmnot}{\op O'}}
U\left[\ketbra{\r}{\r'};\op O\right]  = \nn \\ &= 
U\left[\commutator{\dmnot}{\op O'};\op O\right] \doteq \trace{(\op O' \coupl) \op O } \;,
\end{align}
where the second equality follows from the linearity of the coupling kernel. The right action of the coupling superoperator consistent with this result is:
\be\lb{leftActionCouplingDef2}
(\op O \coupl) = \int \dd\r\dd\r'
U\left[\commutator{\dmnot}{\op O};\ketbra{\r'}{\r}\right]\ketbra{\r}{\r'} \;.
\ee
This formalism allows us to provide a compact expression for the action of the Liouville superoperator on the excitation operators. For the left action we have:
\begin{align}
\Liouv\op E &= \sum_p\left(\hnot-\eps_p\right)\ketbra{\phi_p}{\psi_p} - \sum_p\ket{\psi_p} \bra{\chi^E_p}\left(\hnot-\eps_p\right) + \nn \\
&+ \sum_p \sint \dd\alpha  U[\decay{\alpha}{p}; \op E] \ketbra{\psi(\alpha)}{\psi_p}
- \sum_p \sint \dd\alpha U[\excite{p}{\alpha}; \op E] \ketbra{\psi_p}{\psi(\alpha)} = E\op E \;,
\end{align}
where the action of the coupling superoperator on $\op E$ has been computed imposing its expansion in the transition basis and computing the coefficients with formula 
\eqref{leftActionCouplingDef1}. Projecting out the previous equation by multiplication with an occupied eigenstates from both the left and right provides the equations:
\begin{align}
\left(\hnot-\eps_p\right)\ket{\phi_p} +\sint \dd\alpha  U[\decay{\alpha}{p}; \op E] \ket{\psi(\alpha)} &= E\ket{\phi_p} \nn \\
\bra{\chi_p}\left(\hnot-\eps_p\right) +\sint \dd\alpha \bra{\psi(\alpha)} U[\excite{p}{\alpha}; \op E] &= -E\bra{\chi_p} 
\end{align}


\section{Draft of the paper - old notes}

\begin{itemize}
\item Aim of the paper: Compute the electronic properties of a molecular system with the formalism of linear scaling using a LR-TDDFT inside BigDFT code. 
%We also want to define a set of computational tools that allow to check the reliability of the computation.  
\end{itemize}

\begin{itemize}
\item Motivation: the DFT code have reached reliable features of precision for the computation of the GS. The same probletic are instead needed in order to achieve the same type of results for spectroscopic properties in large systems
\begin{itemize}
\item Quantify the impact of several modelling of a given systems (environment, disorder)
\item Systematic approach has proven its effectiveness for GS calculations (easy to handle)~\cite{deltatest2016}. The quality of localized basis function is therefore easy to quantify (variational theorem)
\item A challenge is represented by large scale computation for \emph{molecular} systems
\end{itemize}
\item State-of-the-art 
\begin{itemize}
\item localized basis set for representing the Hamiltonians (e.g. Fiesta (Blase, Olevano), FHI-Aims, GWMol)
\item This approach has been also generalized to LR calculation in the case of ONETEP \cite{Ratcliff2013}. However little is said about the reliability of the results in terms of the convergence of the spectra
\end{itemize}
\item Content of the paper: 
\begin{itemize}
\item Brief illustration of the support function approach in wavelets (Large systems are  accessible for the structure (Energy, Forces,\ldots)
\item We want to exploit the wavelet properties in the context of LR, \emph{by also providing some criteria} which may be of interest for the evaluation of the quality of the LR results.
\end{itemize}
\item Conclusions and implications
\begin{itemize}
\item We might apply this formalism also in the contect of MBPT and inspect the validity of the linear response functional for e.g. GW calcualtions (the perturbation operator will be different from the dipole)
\end{itemize}
\end{itemize}


% \section{Introduction}
% 
% \subsection{How to add Comments}
% 
% Comments can be added to your project by clicking on the comment icon in the toolbar above. % * <john.hammersley@gmail.com> 2016-07-03T09:54:16.211Z:
% %
% % Here's an example comment!
% %
% To reply to a comment, simply click the reply button in the lower right corner of the comment, and you can close them when you're done.
% 
% Comments can also be added to the margins of the compiled PDF using the todo command\todo{Here's a comment in the margin!}, as shown in the example on the right. You can also add inline comments:
% 
% \todo[inline, color=green!40]{This is an inline comment.}
% 
% \subsection{How to add Tables}
% 
% Use the table and tabular commands for basic tables --- see Table~\ref{tab:widgets}, for example. 
% 
% \begin{table}
% \centering
% \begin{tabular}{l|r}
% Item & Quantity \\\hline
% Widgets & 42 \\
% Gadgets & 13
% \end{tabular}
% \caption{\label{tab:widgets}An example table.}
% \end{table}
% 
% \subsection{How to add Citations and a References List}
% 
% You can upload a \verb|.bib| file containing your BibTeX entries, created with JabRef; or import your \href{https://www.overleaf.com/blog/184}{Mendeley}, CiteULike or Zotero library as a \verb|.bib| file. You can then cite entries from it, like this: \cite{greenwade93}. Just remember to specify a bibliography style, as well as the filename of the \verb|.bib|.
% 
% You can find a \href{https://www.overleaf.com/help/97-how-to-include-a-bibliography-using-bibtex}{video tutorial here} to learn more about BibTeX.
% 
% We hope you find Overleaf useful, and please let us know if you have any feedback using the help menu above --- or use the contact form at \url{https://www.overleaf.com/contact}!

\bibliographystyle{alpha}
\bibliography{sample}

\end{document}